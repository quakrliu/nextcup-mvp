// 5. 執行核銷 (改良偵錯版)
        async function redeemGift() {
            let code = prompt("請店員輸入核銷密碼：");
            
            if (code !== "8888") {
                alert("❌ 密碼錯誤");
                return;
            }

            // 顯示處理中
            const btn = document.getElementById('btn-redeem');
            btn.innerText = "連線寫入中...";
            btn.disabled = true;

            // 準備要更新的資料 (先只更新 Status，減少出錯機率)
            // 如果您的時間欄位名稱不是 Redeemed_Time，這一行會導致失敗，所以我們先註解掉時間
            const data = {
                fields: {
                    Status: 'Redeemed' 
                    // , Redeemed_Time: new Date().toISOString() // 先暫時不傳時間，確保狀態能變更
                }
            };

            const updateUrl = `https://api.airtable.com/v0/${BASE_ID}/${TABLE_ID}/${recordId}`;
            
            try {
                const response = await fetch(updateUrl, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    alert("✅ 核銷成功！狀態已更新。");
                    location.reload(); 
                } else {
                    // 這裡會抓出真正的錯誤原因
                    const err = await response.json();
                    console.error("Airtable Error:", err);
                    alert("⚠️ 核銷失敗！錯誤原因：\n" + err.error.type + ": " + err.error.message);
                    
                    // 重置按鈕
                    btn.innerText = "店員核銷請點此";
                    btn.disabled = false;
                }
            } catch (e) {
                alert("❌ 連線發生錯誤：" + e);
                btn.innerText = "店員核銷請點此";
                btn.disabled = false;
            }
        }
