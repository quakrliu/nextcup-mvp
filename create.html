<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NextCup è£½ä½œç¦®ç‰©</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; text-align: center; padding: 20px; background-color: #fff8e1; }
        .card { background: white; border-radius: 15px; padding: 30px 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-top: 40px; }
        h1 { color: #d35400; font-size: 24px; margin-bottom: 10px; }
        p { color: #666; line-height: 1.6; }
        .btn { display:none; width: 100%; padding: 15px; background: #06c755; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; text-decoration: none; margin-top: 20px; }
        .loading { font-size: 18px; color: #888; margin-top: 20px; }
    </style>
</head>
<body>

    <div class="card">
        <h1 id="title">ğŸ æ­£åœ¨åŒ…è£ç¦®ç‰©...</h1>
        <p id="desc">ç³»çµ±æ­£åœ¨ç‚ºæ‚¨ç”¢ç”Ÿå°ˆå±¬é€£çµ<br>è«‹ç¨å€™...</p>
        
        <a id="btn-share" class="btn" href="#">LINE çµ¦æœ‹å‹</a>
    </div>

    <script>
        // â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼
        // ã€è«‹å¡«å…¥æ‚¨çš„è³‡æ–™ã€‘(è·Ÿ redeem.html ç”¨ä¸€æ¨£çš„)
        
        const AIRTABLE_TOKEN = 'patWFQeH1vf1ga28J.5d619ffcd3e5e85346fef6d8fd1ad308a5e4e951e630ea7392dff7fe4274662a'; 
        const BASE_ID = 'appg9LVwwgUcig6Ze';          
        const TABLE_ID = 'tbl3Y1Jq4VmlcjQgI';         
        
        // âš ï¸ é‡è¦ï¼šè«‹æŠŠä¸‹é¢æ›æˆæ‚¨ Vercel çš„ç¶²å€ (ä¸è¦æœ‰ https://ï¼Œåªè¦ç¶²åŸŸ)
        // ä¾‹å¦‚ï¼š nextcup-mvp.vercel.app
        const MY_DOMAIN = 'nextcup-mvp-git-main-johnnyliu1979-4925s-projects.vercel.app'; 

        // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

        async function createGift() {
            // 1. è‡ªå‹•ç”¢ç”Ÿä¸€å€‹äº‚æ•¸ ID (ä¾‹å¦‚: Gift_1701234567890)
            const newGiftId = 'Gift_' + Date.now();

            // 2. æº–å‚™å¯«å…¥ Airtable çš„è³‡æ–™
            const data = {
                fields: {
                    Gift_ID: newGiftId,
                    Status: 'Active'
                }
            };

            const url = `https://api.airtable.com/v0/${BASE_ID}/${TABLE_ID}`;

            try {
                // 3. å‘¼å« Airtable API å­˜æª”
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    // 4. æˆåŠŸï¼é¡¯ç¤ºåˆ†äº«æŒ‰éˆ•
                    showSuccess(newGiftId);
                } else {
                    alert("è£½ä½œå¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢è©¦è©¦çœ‹");
                }
            } catch (error) {
                console.error(error);
                alert("é€£ç·šéŒ¯èª¤");
            }
        }

        function showSuccess(giftId) {
            document.getElementById('title').innerText = "ğŸ‰ ç¦®ç‰©åŒ…è£å®Œæˆï¼";
            document.getElementById('desc').innerText = "é€™æ¯å’–å•¡å·²ç¶“æº–å‚™å¥½äº†\nè¶•å¿«å‚³çµ¦æœ‹å‹å§ï¼";
            
            // 5. çµ„åˆå‡ºã€Œé ˜å–é ã€çš„å®Œæ•´é€£çµ
            // é€™è£¡æœƒè‡ªå‹•æŠŠç¶²å€ç·¨ç¢¼ï¼Œè®“ LINE å¯ä»¥é †åˆ©å‚³é€
            const redeemLink = `https://${MY_DOMAIN}/redeem.html?id=${giftId}`;
            
            // è¨­å®š LINE åˆ†äº«é€£çµ (Magic Link)
            const shareText = `å˜¿ï¼é€™å®¶å’–å•¡ä¸éŒ¯ï¼Œæˆ‘è«‹ä½ å–ä¸€æ¯ï¼é»é€™è£¡é ˜å–ï¼š ${redeemLink}`;
            const lineUrl = `https://line.me/R/msg/text/?${encodeURIComponent(shareText)}`;
            
            const btn = document.getElementById('btn-share');
            btn.style.display = 'block';
            btn.href = lineUrl;
        }

        // æ‰“é–‹ç¶²é æ™‚è‡ªå‹•åŸ·è¡Œ
        createGift();

    </script>
</body>
</html>
